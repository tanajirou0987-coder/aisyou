# 機能仕様書

## 1. 相性診断機能

### 1.1 診断システム概要
相性診断機能は、心理学理論に基づいた20タイプ分析システムを使用して、個人間の相性を分析します。

#### 1.1.1 質問システム
- **質問数**: 15問（固定）
- **回答形式**: YES/NO形式
- **質問カテゴリ**: 
  - 開放性 (Openness)
  - 誠実性 (Conscientiousness) 
  - 外向性 (Extraversion)
  - 協調性 (Agreeableness)
  - 神経症傾向 (Neuroticism)

#### 1.1.2 分析ロジック
```typescript
// 主要な計算システム
- combination16TypeSystem.ts      # 16タイプ組み合わせシステム
- compatibilityCalculator.ts     # 基本相性計算
- compatibilityMatrixCalculator.ts # 相性マトリックス計算
- psychologyCompatibilityCalculator.ts # 心理学相性計算
- simpleCompatibilityCalculator.ts # 簡易相性計算
```

### 1.2 20タイプ分析システム

#### 1.2.1 タイプ分類
1. **冒険的社交家** - 新しい体験を好み、社交的
2. **内省的探求者** - 深く考えることを好み、探求心旺盛
3. **安定した社交家** - 安定を好み、社交的
4. **安定した内省家** - 安定を好み、内省的
5. **成長志向の仕事人** - 仕事での成長を重視
6. **安定志向の仕事人** - 仕事での安定を重視
7. **成長志向の生活人** - 生活での成長を重視
8. **安定志向の生活人** - 生活での安定を重視
9. **率直なグループリーダー** - 率直でリーダーシップがある
10. **率直な個人主義者** - 率直で個人主義的
11. **思いやりのある協調者** - 思いやりがあり協調的
12. **思いやりのある個人主義者** - 思いやりがあり個人主義的
13. **価値観リーダー** - 価値観を重視しリーダーシップがある
14. **価値観フォロワー** - 価値観を重視し従順
15. **価値観探求者** - 価値観を探求し続ける
16. **価値観安定者** - 価値観を安定させたい
17. **コミュニケーション直接型** - 直接的で率直なコミュニケーション
18. **コミュニケーション穏やか型** - 穏やかで配慮のあるコミュニケーション
19. **コミュニケーション分析型** - 分析的で論理的なコミュニケーション
20. **コミュニケーション感情型** - 感情的で共感的なコミュニケーション

#### 1.2.2 相性計算
```typescript
// 相性スコア計算の流れ
1. 参加者の回答データを取得
2. 共通の質問に対する回答を比較
3. 回答の類似度を計算
4. 質問の重要度（重み）を考慮
5. 最終的な相性スコア（0-100）を算出
```

### 1.3 結果表示機能

#### 1.3.1 相性ランキング
- 参加者間の相性スコア順位
- 相性の良いペアの表示
- 相性の悪いペアの表示

#### 1.3.2 詳細分析
- 各ペアの詳細な相性分析
- 相性の良い点・悪い点
- 具体的なアドバイス
- デートアイデアの提案

## 2. 酒癖マッチング機能

### 2.1 酒癖診断システム

#### 2.1.1 質問システム
- **質問数**: 15問
- **回答形式**: YES/NO形式
- **質問カテゴリ**:
  - 恋愛積極性
  - 盛り上げ力
  - 社交性
  - 本音度
  - 飲酒量

#### 2.1.2 6つの酒癖タイプ
1. **ソーシャルエンハンサー** - 社交性と盛り上げ力が高い
2. **エモーショナルエクスプレス** - 本音度が高く、感情表現が豊か
3. **コンフィデンスブースター** - 恋愛積極性が高く、自信が向上
4. **ストレスリリーバー** - 飲酒量が多く、ストレス解消目的
5. **ロマンティックエンハンサー** - 恋愛積極性と社交性のバランス
6. **インヒビテッドリリーサー** - 複数のカテゴリで中程度のスコア

### 2.2 グループ診断機能

#### 2.2.1 セッション管理
- セッションIDの生成
- 参加者の登録
- リアルタイムでの進捗確認
- 全員の回答完了待機

#### 2.2.2 相性分析
```typescript
// グループ相性計算の流れ
1. 男性と女性の参加者を分離
2. 異性間の組み合わせのみ相性スコアを計算
3. 回答の一致度を計算
4. ランダム要素を追加して自然な結果に
5. 相性ランキングの生成
```

### 2.3 結果表示機能

#### 2.3.1 グループ結果
- グループ全体の相性マトリックス
- 最良のペアの表示
- 最悪のペアの表示
- 完了状況の表示

#### 2.3.2 個別分析
- 個人の酒癖タイプ分析
- ペア間の詳細分析
- おすすめ活動の提案
- コミュニケーションのコツ

## 3. 質問データシステム

### 3.1 質問データ構造
```typescript
interface Question {
  id: string
  text: string
  options: Option[]
  category: string
  weight: number
}

interface Option {
  id: string
  text: string
  value: number
  description?: string
}
```

### 3.2 質問セット
- **相性診断質問**: `psychologyQuestions.ts`
- **酒癖診断質問**: `drinkingQuestions.ts`
- **強制選択質問**: `forcedChoiceQuestions.ts`
- **固定15問**: `fixed15Questions.ts`

### 3.3 質問の重み付け
- **重要度1**: 基本的な質問
- **重要度2**: 中程度の重要度
- **重要度3**: 高重要度の質問

## 4. 計算ロジックシステム

### 4.1 相性計算アルゴリズム

#### 4.1.1 基本相性計算
```typescript
function calculatePairCompatibility(participant1: Participant, participant2: Participant): CompatibilityScore {
  // 1. 共通の質問を特定
  // 2. 各質問の回答を比較
  // 3. 回答の類似度を計算
  // 4. 質問の重みを考慮
  // 5. 最終スコアを算出
}
```

#### 4.1.2 心理学相性計算
```typescript
function calculatePairPsychologyCompatibility(participant1: Participant, participant2: Participant): CompatibilityScore {
  // 1. ビッグファイブ特性を計算
  // 2. 特性の相性を分析
  // 3. 相性スコアを算出
}
```

### 4.2 酒癖分析アルゴリズム

#### 4.2.1 タイプ判定
```typescript
function determineDrinkingType(participant: Participant): string {
  // 1. 各カテゴリのスコアを計算
  // 2. 最も高いスコアのカテゴリを特定
  // 3. 科学的根拠に基づくタイプ判定
  // 4. 最終タイプを決定
}
```

#### 4.2.2 相性マトリックス
```typescript
const compatibilityMatrix = {
  'social_enhancer': {
    'romantic_enhancer': 88,
    'emotional_expresser': 82,
    'confidence_booster': 78,
    // ...
  },
  // ...
}
```

## 5. データ管理システム

### 5.1 ローカルストレージ
- **診断結果**: ブラウザローカルストレージでの保存
- **セッション管理**: 一時的なセッションデータ
- **設定情報**: ユーザー設定の保存

### 5.2 データ形式
- **JSON形式**: 構造化されたデータ形式
- **型安全性**: TypeScriptによる型定義
- **バリデーション**: データの整合性チェック

## 6. パフォーマンス最適化

### 6.1 計算最適化
- **高速化**: 重要な質問のみを分析（重要度3以上）
- **事前計算**: 相性マトリックスの事前計算
- **キャッシュ**: 計算結果のキャッシュ

### 6.2 メモリ管理
- **状態のクリーンアップ**: 不要な状態の削除
- **イベントリスナーの削除**: メモリリークの防止
- **ガベージコレクション**: 効率的なメモリ使用

## 7. エラーハンドリング

### 7.1 入力エラー
- **必須項目チェック**: 必須入力の検証
- **形式チェック**: 入力形式の検証
- **エラーメッセージ**: 分かりやすいエラー表示

### 7.2 システムエラー
- **ネットワークエラー**: 通信エラーの処理
- **ブラウザエラー**: ブラウザ固有のエラー処理
- **フォールバック**: エラー時の代替処理

## 8. セキュリティ考慮事項

### 8.1 データ保護
- **個人情報**: 最小限の個人情報収集
- **データ暗号化**: 機密データの暗号化
- **セキュア通信**: HTTPS通信の強制

### 8.2 プライバシー
- **データ保持期間**: セッション終了後のデータ削除
- **第三者提供**: データの第三者提供禁止
- **ユーザー同意**: データ使用の明示的同意

---

**作成日**: 2024年12月19日  
**バージョン**: 1.0  
**関連ドキュメント**: [requirements.md](./requirements.md), [functional-requirements.md](./functional-requirements.md), [architecture.md](./architecture.md)
